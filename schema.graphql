type Borrow @entity(immutable: true) {
  id: Bytes!
  user: Bytes! # address
  token: Bytes! # address
  amount: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type BorrowTokenSet @entity(immutable: true) {
  id: Bytes!
  token: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type CollateralTokenSet @entity(immutable: true) {
  id: Bytes!
  token: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type Initialized @entity(immutable: true) {
  id: Bytes!
  version: BigInt! # uint64
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type InterestRateModelSet @entity(immutable: true) {
  id: Bytes!
  interestRateModel: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type Liquidation @entity(immutable: true) {
  id: Bytes!
  borrower: Bytes! # address
  borrowToken: Bytes! # address
  collateralToken: Bytes! # address
  userBorrowAssets: BigInt! # uint256
  collateralTokenIds: [BigInt!]! # uint256[]
  liquidatorTokenIds: [BigInt!]! # uint256[]
  borrowerTokenIds: [BigInt!]! # uint256[]
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type LtvSet @entity(immutable: true) {
  id: Bytes!
  ltv: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type MinSupplyAmountSet @entity(immutable: true) {
  id: Bytes!
  token: Bytes! # address
  amount: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type Paused @entity(immutable: true) {
  id: Bytes!
  account: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type Repay @entity(immutable: true) {
  id: Bytes!
  user: Bytes! # address
  token: Bytes! # address
  amount: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type RoleAdminChanged @entity(immutable: true) {
  id: Bytes!
  role: Bytes! # bytes32
  previousAdminRole: Bytes! # bytes32
  newAdminRole: Bytes! # bytes32
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type RoleGranted @entity(immutable: true) {
  id: Bytes!
  role: Bytes! # bytes32
  account: Bytes! # address
  sender: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type RoleRevoked @entity(immutable: true) {
  id: Bytes!
  role: Bytes! # bytes32
  account: Bytes! # address
  sender: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type RouterSet @entity(immutable: true) {
  id: Bytes!
  router: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type SupplyCollateral @entity(immutable: true) {
  id: Bytes!
  user: Bytes! # address
  token: Bytes! # address
  tokenId: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type SupplyLiquidity @entity(immutable: true) {
  id: Bytes!
  user: Bytes! # address
  token: Bytes! # address
  amount: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type Unpaused @entity(immutable: true) {
  id: Bytes!
  account: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type Upgraded @entity(immutable: true) {
  id: Bytes!
  implementation: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type WithdrawCollateral @entity(immutable: true) {
  id: Bytes!
  user: Bytes! # address
  token: Bytes! # address
  tokenId: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type WithdrawLiquidity @entity(immutable: true) {
  id: Bytes!
  user: Bytes! # address
  token: Bytes! # address
  amount: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}
type InterestRateModelInitialized @entity(immutable: true) {
  id: Bytes!
  version: BigInt! # uint64
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type LendingPoolBaseRateSet @entity(immutable: true) {
  id: Bytes!
  lendingPool: Bytes! # address
  rate: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type LendingPoolMaxUtilizationSet @entity(immutable: true) {
  id: Bytes!
  lendingPool: Bytes! # address
  utilization: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type LendingPoolOptimalUtilizationSet @entity(immutable: true) {
  id: Bytes!
  lendingPool: Bytes! # address
  utilization: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type LendingPoolRateAtOptimalSet @entity(immutable: true) {
  id: Bytes!
  lendingPool: Bytes! # address
  rate: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type InterestRateModelRoleAdminChanged @entity(immutable: true) {
  id: Bytes!
  role: Bytes! # bytes32
  previousAdminRole: Bytes! # bytes32
  newAdminRole: Bytes! # bytes32
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type InterestRateModelRoleGranted @entity(immutable: true) {
  id: Bytes!
  role: Bytes! # bytes32
  account: Bytes! # address
  sender: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type InterestRateModelRoleRevoked @entity(immutable: true) {
  id: Bytes!
  role: Bytes! # bytes32
  account: Bytes! # address
  sender: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type ScaledPercentageSet @entity(immutable: true) {
  id: Bytes!
  percentage: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type InterestRateModelUpgraded @entity(immutable: true) {
  id: Bytes!
  implementation: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type UserLiquidity @entity(immutable: false) {
  id: Bytes! # lendingPool-user composite key
  market: Market!
  user: Bytes! # user address
  token: Bytes! # token address (borrow token)
  totalDeposited: BigInt! # Total deposited by user
  totalWithdrawn: BigInt! # Total withdrawn by user
  currentBalance: BigInt! # Current balance (deposited - withdrawn)
  currentApy: BigInt! # Current supply APY (calculated from borrow rate)
  earnedYield: BigInt! # Accumulated yield earned
  lastUpdatedTimestamp: BigInt! # Last update timestamp for yield calculation
}

type Market @entity(immutable: false) {
  id: Bytes! # lendingPool address
  totalBorrowAssets: BigInt!
  totalSupplyAssets: BigInt!

  # Interest Rate Model Parameters
  interestRateModel: Bytes # address
  baseRate: BigInt!
  optimalUtilization: BigInt!
  rateAtOptimal: BigInt!
  maxUtilization: BigInt!

  # Calculated State
  borrowRate: BigInt!
  utilization: BigInt!

  # User tracking and deposit cap
  users: Int! # Count of unique liquidity suppliers
  depositCap: BigInt! # Maximum deposit allowed (0 = no cap)
  uniqueSuppliers: [UserLiquidity!]! @derivedFrom(field: "market")
}

type InterestRateModelConfig @entity(immutable: false) {
  id: Bytes! # interestRateModel address
  scaledPercentage: BigInt!
}
